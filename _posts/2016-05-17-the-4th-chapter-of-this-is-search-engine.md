---
layout:     post
title:      "这就是搜索引擎第四章-索引压缩"
subtitle:   "这就是搜索引擎读书笔记"
date:       2016-05-17
author:     "秀川"
header-img: "img/post-bg-re-vs-ng2.jpg"
header-mask: 0.3
catalog:    true
tags:
    - 读书笔记
    - 《这就是搜索引擎》
    - 搜索
    - 索引压缩
---

# 索引压缩
索引压缩可以利用数据压缩算法，有效的将数据量减少，这样一方面可以减少索引占用的磁盘空间量，另一方面可以减少磁盘读写数据量，加快用户查询的响应速度。

倒排索引包含单词词典和倒排列表，所以针对索引的压缩算法，也分为针对词典的压缩与针对倒排列表的压缩。而对倒排列表的压缩又可以分为无损压缩与有损压缩

## 词典压缩
为了响应用户查询，词典信息往往会全部加载到内存中，以加快查找速度。如果数据量很大，内存未必能够放得下所有的词典数据，为了减小词典信息所占内存，一般可以考虑词典压缩技术来达到此目的。

![词典信息结构](词典信息结构.jpg "词典信息结构")

单词的长度往往不一致，所以我们可以对这个字段信息进行压缩。

我们把所有的单词连续的存储在某个内存中，原先存储单词内容的部分由指向这个存储区对应单词起始位置的指针代替。单词的结尾可以用词典中下一个单词的指针所指向位置来做判断。

进一步优化方案：

每个单词前面加上单词的长度信息，然后再存储到一块连续的内存中，让相邻的两项或者多项共用一个指针。假如是两个单词共用一个位置指针，这样就可以节省4个字节。

![进一步优化单词存储](进一步优化单词存储.jpg "进一步优化单词存储")

## 倒排列表压缩算法
单词对应的倒排列表记载3类信息：文档编号，词频信息和单词的位置信息。因为文档编号以及单词位置序列是一次递增的，所以通常的做法是存储其***差值***，而非原始数据，经过差值转换，文档编号和单词位置信息往往会被转换成小整数，而词频信息大部分是小整数。

### 评价索引压缩算法的指标
* 压缩率

数据压缩前的大小与压缩后的大小的比例关系，压缩率越高越节省空间

* 压缩速度

压缩一定量的数据所花费的时间，这个指标没有其他两个指标重要

* 解压速度

解压速度是3个指标中最重要的，其含义就是将压缩的数据再次恢复为原始数据所需时间

### 一元编码和二进制编码

一元编码和二进制编码是所有压缩算法的基本构成元素，不论压缩算法内部逻辑怎么样，最终都是以这两种双方是对数据进行表示。要么使用一元编码和二进制编码混合使用，用么是单独使用二进制编码。可以认为这两种编码格式是压缩算法的基础构件。

一元编码的数据表示方式：对于整数X来说，使用X-1个二进制数字1和一个数字0来表示这个整数。**一元编码只适合非常小的整数。
**

![一元编码]()

二进制编码是计算机内部的标准数据存储方式，即用二进制0和1表示实际的数据。不同比特宽度代表了不同数字的范围。

![二进制编码]()

### Elias Gamma算法和Elias Delta算法
Elias Gamma算法采用的分解函数：x=2<sup>e</sup> + d。 e + 1采用一元编码，d采用比特宽度为e的二进制编码来表示。

例如：待压缩数字为9, 9可以分解为2的3次方，加上1, 3用一元编码转换之后为1110，1以3的比特宽度用二进制表示为001，所以压缩以后的编码为1110:001

Elias Delta 算法是在Elias Gamma算法的基础上对因子d采用比特长度为e的二进制编码进行编码，对于e + 1再次进行Elias Gamma算法进行编码。

例如：带压缩数字9，9可以分解为2的3次方，加上1，对1进行二进制编码为001，对3 + 1进行再次Elias Gamma 算法压缩， 得到110:00, 最后结果为110:00:001

### Golomb算法 和Rice 算法
Golomb算法和Rice 算法与Elias 算法的区别是分解函数不相同。Golomb算法和Rice算法采用下面的分解函数：因子1=（X-1）/ b, 因子2=（X-1）% b

这两个算法的区别就是b怎么选择的问题。

Golomb算法先计算待压缩序列的平均值avg，然后在通过` b=0.69 x avg `来得到b的值，其中0.69是一个经验值

Rice算法则要求b一定要为2的整数次幂，同时b必须是所有小于平均值avg的2的整数次幂的数值中最接近avg的数值

![Golomb算法以及Rice算法]()

### 变长字节算法
对于不同的待压缩数字来说，在压缩编码后占用的字节数不一定相同，所以叫`变长字节`。

变长字节算法会有一个bit位是用来说明边界的，如果以0为边界，那么如果这个边界是1，则认为下个字节还是当前的数字的，如果为0，则说明下个字节已经是下一个数字的了

![字节变长算法]()

### SimpleX 算法
SimpleX算法是一种字对齐算法，最常用32个比特位（4个字节）来作为一个压缩单位，给固定大小的压缩单位后，每个压缩单位试图存储多个待压缩的数字，如图：

![Simple9算法]()

Simple9算法把32个bit位划分为两个组成部分，其中4个作为管理数据存储区，用于觉得后面28位是按照几个bit来存储一个数字的。

### PForDelta 算法
PForDelta算法是目前解压速度最快的一种倒排文件压缩算法，其出发点是尽可能一次性压缩和解压多个数值。

PForDelta算法对连续的K个值，一般K取128，即一次性解压缩128个数值，找出其中的10%比例的大数，根据剩余的90%的数值范围来决定应该采取的比特宽度，而10%的大数做为异常数据单独存储。

![PForDelta]()

## 文档编号重排序
文档编号重排序的核心目的是重新编排文档，使得某个单词倒排列表中相邻的两个文档的文档编号尽可能相近。可以采取文本聚类的方式，将内容相似的网页聚合在一起。

在互联网海量的数据量下，文本聚类的速度难以满足实际的需求，所以可以使用一种非常有效的启发规则：将页面URL相似的网页聚合在一起，这里主要考虑到，同一个网站的很多页面表达的主体内容是近似的，通过这种方式非常有效的将网页聚合在一起，之后根据聚类结果对文档ID进行重新编号，这样可以高效的完成文档编号重排序任务。

## 静态索引裁剪

